---
title: 装载与动态链接
date: 2018-07-17 14:53:09
tags: [杂谈, 技术]
category: 杂谈
toc: true
mathjax: true


---

# 装载与动态链接

可执行文件只有装载到内存以后才能被CPU执行。早期的程序装载十分简陋，装载的基本过程就是把程序从外部存储器中读取到内存中的某个位置。随着硬件MMU的诞生，多进程、多用户、虚拟存储的操作系统出现以后，可执行文件的装载过程变得非常复杂。

可执行文件需要运行时，都必须先被装载到内存，才能被CPU进行执行。

每个程序被运行起来后，都有自己独立的虚拟地址控件（**Virtual Address Space**），大小由计算机的硬件平台决定，比如32位的CPU理论上只有4GB的极限寻址能力。

##### 1. 覆盖装载（几乎已经不用的装载方式）

当程序运行的时候，需要把程序的指令装载进内存，但是一个大程序往往使用到的只是一部分功能，或者说常用的只是一部分功能，如果把程序的所有执行命令都装载了，会让内存变得捉襟见肘。当 A 模块 会依赖到 B 和 C模块，并且 BC之间并没有直接调用关系时候，内存可以只加载A模块，并且自己编写覆盖管理器（**Overlay Manager**），在需要的时候分别把需要的B装载进内存，并且把C移出内存，反之亦然。当程序变得非常大，并且依赖关系复杂了，这种情况，装载管理器就变得非常复杂了。

##### 2. 页映射

是虚拟存储机制的一部分。

与覆盖装入的原理相似，页映射也不是一下子就把程序的所有数据和指令都装入内存，而是将内存和所有磁盘中的数据和指令按照“页（Page）”为单位划分成若干个页，以后所有的装载和操作的单位就是页。

假设当程序大小足够分为8页，而内存只足够分4页，假设使用一个加载器进行加载程序，需要用到的程序往内存里面加载，当内存满了之后，需要再加载另一个程序页的时候，一般会使用各种算法，计算出暂时不使用的程序页，用新的程序页进行覆盖。



#### 动态链接

动态链接本质上是把目标文件的链接工作放在了程序装载的时候，其主要工作和静态链接差不多，链接符号，重定位地址。

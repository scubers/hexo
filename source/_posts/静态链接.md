---
title: 静态链接
date: 2018-07-16 14:53:09
tags: [杂谈, 技术]
category: 杂谈
toc: true
mathjax: true

---



# 静态链接

## 编译和连接

从代码到执行文件的过程，IDE把其中的过程隐藏了，并美其名曰（build），在build的过程中，分别做了一下4个步骤

1. 预处理（Processing）

2. 编译（Compilation）

3. 汇编（Assembly）

4. 链接（Linking）



##### 1. 预编译：

命令：`gcc -E hello.c -o hello.i` 或者  `cpp hello.c > hello.i`

通过.h 头文件进行预编译，处理例如 `#if, #define` 等预编译命令，生成预编译完成文件`xxx.i`文件；

- 将所有`#define` 删除，并且展开所有宏定义

- 处理所有预编译指令，例如`#if, #ifdef, ##elif`等

- 处理`#include` 指令，且递归执行

- 删除所有注释

- 添加行号，以及文件名标识 

- 保留所有`#pragma`指令，因为编译器需要用到

##### 2. 编译：

编译过程就是把预处理完的文件进行一系列词法分析、语法分析、语义分析及优化后生产相应的汇编代码文件。

命令：`gcc -S hello.i -o hello.s`

编译过程一般可以分为6步：

扫描源码、语法分析、语义分析、源代码优化（~生成中间代码）、代码生成、目标代码优化；

编译器分编译器前端和编译器后端

编译器前端到生成 **生成中间代码** ，之后都属于 **编译器后端**

##### 3. 汇编：

将会变代码转化为机器可以执行的命令，每一个汇编语句几乎都对应一条机器指令。

命令：`as hello.s -o hello.o` 或者 `gooc -c hello.c -o hello.o`

##### 4. 链接：

输出可执行文件的最重要的一步。

编译后的代码没有具体的内存地址，并且如果代码中还引用了其他静态库的变量或者方法，这些内存地址需要通过链接来确定，并最后生成可执行文件。


